(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))s(t);new MutationObserver(t=>{for(const r of t)if(r.type==="childList")for(const a of r.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&s(a)}).observe(document,{childList:!0,subtree:!0});function i(t){const r={};return t.integrity&&(r.integrity=t.integrity),t.referrerPolicy&&(r.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?r.credentials="include":t.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function s(t){if(t.ep)return;t.ep=!0;const r=i(t);fetch(t.href,r)}})();function c(n){const e=document.getElementById(n);if(!e)throw new Error(`Element '${n}' not found`);return e}const o={window:c("console-window"),content:c("console-content"),command_path:c("console-command-path"),input_command:c("console-command"),clear_button:c("console-clear-button"),hide_button:c("console-hide-button"),show_button:c("console-show-button")};o.window.addEventListener("click",()=>{m()});o.clear_button.addEventListener("click",()=>{p()});o.show_button.addEventListener("click",()=>{f(),m()});o.hide_button.addEventListener("click",()=>{k()});function p(){o.content.innerText=""}function f(){o.window.style.display="block",o.show_button.style.display="none"}function k(){o.window.style.display="none",o.show_button.style.display="block"}function m(){o.input_command.focus()}function w(n){o.content.innerText+=n}function l(n){h("[SYSTEM][I]: ",n)}function d(n){h("[SYSTEM][E]: ",n)}function E(n){h("[ARDUINO]: ",n)}function h(n,e){w(n+e+`
`),console.log(n+e)}const _={status:c("arduino-status"),keep_connection_checkbox:c("arduino-keep-connection-checkbox")};class y{__socket;__keep_connection;SERVER_ADDRESS="192.168.1.10:55555";constructor(){this.__socket=null,this.__keep_connection=!1}getConnectionMode(){return this.__keep_connection}setConnectionMode(e){this.__keep_connection=e}connect(){return this.isOpen()&&this.__socket.close(),this.__socket=new WebSocket(`ws://${this.SERVER_ADDRESS}`),this.__socket.onclose=()=>{_.status.innerText="Disconnected",l("Disconnected from the server")},l("Waiting for server to come online..."),new Promise((e,i)=>{if(!this.__socket)return i();this.__socket.onopen=()=>(_.status.innerText="Connected",l("Connected to the server"),e()),this.__socket.onerror=s=>(d(`WebSocket error: ${s}`),i())})}sendCommandAndGetOutput(e){return new Promise((i,s)=>{if(!this.isOpen()||!this.__socket)return d("Couldn't send request: socket not initialized"),s();let t;t=`Connection: ${this.__keep_connection?"keep_connection":"close_connection"}`+`
-- HEADER END --
`+e,this.__socket.send(t),l(`Sent request:
${t}`),this.__socket.onmessage=a=>i(a.data),this.__socket.onerror=()=>(d("WebSocket error"),s())})}async getHostsJson(){try{return await this.connect(),await this.sendCommandAndGetOutput("GetHostsJson")}catch(e){throw console.error("Error obtaining hosts JSON: ",e),e}}isOpen(){return this.__socket?.readyState===WebSocket.OPEN}}const u=new y;o.command_path.innerText=`Arduino@${u.SERVER_ADDRESS}>`;o.input_command.addEventListener("keydown",n=>{if(n.key==="Enter"){const e=o.input_command.value.trim();S(e),o.input_command.value=""}});async function S(n){if(u.setConnectionMode(_.keep_connection_checkbox.checked),!n){d("No command provided, skipping");return}let e;u.isOpen()?e=await g(n):e=await b(n),E(e)}async function b(n){try{return await u.connect(),await u.sendCommandAndGetOutput(n)}catch(e){d(`Error during command execution: ${e}`)}}async function g(n){try{return await u.sendCommandAndGetOutput(n)}catch(e){d(`Error during command execution: ${e}`)}}
